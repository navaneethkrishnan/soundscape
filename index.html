<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radar Sound Scanner</title>
    <style>
        body { margin: 0; background: #001100; color: #0f0; overflow: hidden; font-family: monospace; }
        canvas { display: block; }
        .overlay { position: absolute; top: 10px; left: 10px; z-index: 10; pointer-events: none; }
        button { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 15px 30px; font-size: 20px; background: #0f0; color: black; border: none; cursor: pointer; border-radius: 5px; box-shadow: 0 0 20px #0f0; }
    </style>
</head>
<body>

    <div class="overlay">
        <div>RADAR: ACTIVE</div>
        <div id="status">Scanning...</div>
    </div>
    <button id="startBtn">START SCANNER</button>
    <canvas id="radar"></canvas>

    <script>
        const startBtn = document.getElementById('startBtn');
        const canvas = document.getElementById('radar');
        const ctx = canvas.getContext('2d');
        const statusDiv = document.getElementById('status');

        startBtn.onclick = async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                startBtn.style.display = 'none';
                
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioCtx.createMediaStreamSource(stream);
                const analyser = audioCtx.createAnalyser();
                analyser.fftSize = 256;
                source.connect(analyser);

                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);

                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                let angle = 0;
                
                function draw() {
                    requestAnimationFrame(draw);
                    
                    // പശ്ചാത്തലം മങ്ങിക്കാൻ (Fading effect)
                    ctx.fillStyle = 'rgba(0, 20, 0, 0.05)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    const cx = canvas.width / 2;
                    const cy = canvas.height / 2;
                    const maxRadius = Math.min(cx, cy);

                    // ഗ്രിഡ് വരയ്ക്കുന്നു
                    ctx.strokeStyle = '#004400';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.arc(cx, cy, maxRadius * 0.3, 0, Math.PI * 2);
                    ctx.arc(cx, cy, maxRadius * 0.6, 0, Math.PI * 2);
                    ctx.arc(cx, cy, maxRadius * 0.9, 0, Math.PI * 2);
                    ctx.stroke();

                    // റഡാർ സ്കാനിംഗ് ലൈൻ (കറങ്ങുന്ന വര)
                    angle += 0.02;
                    ctx.strokeStyle = '#0f0';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(cx, cy);
                    ctx.lineTo(cx + Math.cos(angle) * maxRadius, cy + Math.sin(angle) * maxRadius);
                    ctx.stroke();

                    // ശബ്ദം വിശകലനം ചെയ്യുന്നു
                    analyser.getByteFrequencyData(dataArray);
                    
                    // ശബ്ദമുണ്ടെങ്കിൽ മാത്രം പച്ച പൊട്ടുകൾ ഇടുന്നു
                    for (let i = 0; i < bufferLength; i++) {
                        const volume = dataArray[i];
                        
                        if (volume > 50) { // ശബ്ദം 50-ൽ കൂടുതലാണെങ്കിൽ
                            const distance = (i / bufferLength) * maxRadius; // ഫ്രീക്വൻസി അനുസരിച്ച് ദൂരം
                            
                            // സ്കാനർ കറങ്ങുന്ന ദിശയിൽ മാത്രം പൊട്ടുകൾ
                            const x = cx + Math.cos(angle) * distance;
                            const y = cy + Math.sin(angle) * distance;

                            ctx.fillStyle = `rgba(0, 255, 0, ${volume / 255})`;
                            ctx.beginPath();
                            ctx.arc(x, y, 3, 0, Math.PI * 2);
                            ctx.fill();
                        }
                    }
                }
                draw();

            } catch (err) {
                alert("Error: " + err.message);
            }
        };
    </script>
</body>
</html>
